# 웹서버(WS)와 웹어플리케이션서버(WAS)

![How To Setup Tomcat in Linux Mint – Truelogic Blog](https://lh3.googleusercontent.com/proxy/mxxE2UoE3I90GzmQTzRody7dOEZqlO0FuU7B162c26M6c69SwNQTgEQdp9injwLKG5v1ei6VhDUtppP9rXEimiwn_HPn2u07w6u-mf4e5Q8UzZMuXipIcFFHhkA5D09g0mG1J476F6s_XfT3WdvykqTFeX6SdRM)

### 웹서버(WS)

- __클라이언트로부터 http 요청을 받아, 응답으로 HTML 문서와 같은 웹페이지를 반환하는 프로그램__

  - 웹페이지에는 이미지, CSS, JS 등의 여러 정적인 리소스가 포함되어 있음

- __클라이언트로부터 콘텐츠를 전달받는 것도 웹서버의 기능이라 할 수 있음__

  - 주로 파일 업로드나, 클라이언트에서 제출한 form을 수신하는 경우가 이에 속함

- 정적인 결과물만을 제공하기 때문에 후술할 __`WAS`__ 에 비해 처리 속도가 빠르지만, 제공되는 서비스가 그만큼 한정적임

  - 글의 추가 및 수정 등과 같은 여러 동적인 작업이 수반될수록 처리가 번거로움

  

- __`Apache`__ , __`nginx`__ 등의 다양한 웹서버가 존재함

  - __Apache__ : __`MPM 방식`__ 으로 http 요청을 처리함

    - Multi-Process Module(다중 처리 모듈)을 의미하며, 이는 Apache 서버에서 http 요청에 대해 프로세스 혹은 스레드를 기반으로 처리함을 의미
    - __PreFork MPM__ (다중프로세스)
      - 클라이언트의 요청에 대해 미리 여러개의 자식 프로세스를 생성하여 처리함
      - 자식 프로세스는 세부적으로 스레드를 가지며, 스레드 간 메모리 공유는 이루어지지 않음
      - 독립적이기 때문에 안정적이지만, 그만큼 메모리 소모가 큼
    - __Worker MPM__ (멀티 프로세스-스레드)
      - 메모리 사용량이 보다 적고 동시접속이 많은 경우에 적합한 방식으로, __프로세스의 스레드를 생성해 처리__
      - 스레드 간 메모리 공유가 가능하며, 프로세스 당 최대 약 64개의 스레딩이 가능함
      - 각각의 스레드는 하나의 연결만을 부여받음
    - 결국 Apache의 동작은 클라이언트의 요청마다 프로세스나 스레드를 생성하여 이를 처리하는 구조로 정리 가능
    - __만일 동시 요청이 잦아질경우 그만큼 CPU와 메모리의 사용량이 증가하고, 추가적인 프로세스 혹은 스레드의 생성 비용이 커지는 등 대용량 환경에서의 한계가 존재함__

  - __Nginx__ : 비동기적인 __`Event-Driven`__ 방식으로 동작하며, Apache의 프로세스/스레드 기반 구조의 한계를 극복하고자 등장한 웹서버

    - 한 개 혹은 고정된 양의 프로세스만 생성하고, 프로세스 내에서 비동기 방식으로 작업을 처리

      - 따라서, __동시 요청이 잦더라도 새로운 프로세스 혹은 스레드를 생성해야 하는 비용이 수반되지 않음__

        > __Context Switching__
        >
        > 한 프로세스 혹은 스레드가 작업중일 때, 다른 프로세스 혹은 스레드가 자원을 사용하고자 이전 작업에 대한 상태정보 등을 CPU에 적재하는 것을 말함. Context Switching이 잦으면 그만큼 오버헤드가 커져 성능에 문제가 생김

    - 기본적으로 가볍고 높은 성능을 목표로 하며, 이는 서버에의 부하가 클 경우 성능에 대한 예측을 용이하게 함

  - 비교하면 __Apache는 Nginx에 비해 모듈이 다양하고, 기능의 안정성 및 호환성 등에 있어서 훌륭하지만__ , __Nginx는 상대적으로 가볍고 비용이 적게 드는 장점이 있음__



### 웹어플리케이션서버(WAS)



![img](https://gmlwjd9405.github.io/images/web/webserver-vs-was1.png)



- __정적인 컨텐츠만을 제공하는 단순 웹서버(WS)와 달리 동적인 컨텐츠를 만들어 응답하는 서버 프로그램__

  - 서버 내의 다양한 알고리즘, 비즈니스 로직 처리, 트랜잭션 수행 등을 통해 클라이언트의 요청에 맞는 동적인 컨텐츠 제공
  - 대표적으로 Apache의 __`tomcat`__ 이 있음

- WAS는 WS와 __`Web Container`__ 이 합쳐진 것으로 볼 수도 있고, WS와 어플리케이션 간 미들웨어로 볼 수도 있으나 여기서는 전자의 경우로 WAS를 이해하도록 한다

  > __Web Container__
  >
  > 서블릿 컨테이너(Servlet-Container)라고도 하며, 웹서버(WS)가 보낸 jsp, php 등의 파일을 생성 및 실행하여 결과물을 다시 WS로 보내는 역할을 수행하는 소프트웨어

- 즉, WAS는 WS로부터 클라이언트가 보낸 요청을 받는 것이며 요청에 대한 처리는 웹컨테이너로 보내는 것



- __WS와 WAS를 분리하는 이유?__

  > WAS가 WS의 기능을 포함하면 되는데, 둘을 굳이 분리하는 이유는 무엇일까?

  - WS와 WAS의 기능을 서로 분리하여 __과도한 서버 부하를 방지하는 것__

  - 보통 WAS는 동적인 컨텐츠 제공을 위해 비즈니스 로직 수행에 집중하고, 단순한 정적인 컨텐츠 제공만으로도 충분한 경우에는 WAS를 거치지 않고 WS에서 빠르게 처리

    - 정적인 컨텐츠에 대한 요청까지 굳이 WAS에서 처리할 필요가 없는 것

  - 소프트웨어의 물리적인 분리를 통해 보안을 강화시키고자 하는 측면도 있음

  - WS에 여러 대의 WAS를 연결함으로써 __`로드 밸런싱(load balancing)`__ 을 위한 용도로도 사용 가능

    > __로드 밸런싱(부하 분산)__
    >
    > 두개 이상의 중앙처리장치나 저장장치 등의 컴퓨터 자원에게 작업을 분산시키는 네트워크 기술로, 트래픽을 서로 나눠서 처리함으로써 부하를 줄일 수 있음

  - 하나의 서버에서 java, php 등 다양한 환경에서 실행되는 어플리케이션을 같이 활용할 수 있음

    - 예를 들어, __`tomcat`__ 의 경우 java만 해석할 수 있기 때문에 jsp만 처리 가능하고 php는 처리할 수 없는데, WS와 WAS가 서로 분리되어 있을 경우에는 Apache 웹서버로 jsp 뿐만 아니라 php를 같이 사용할 수 있게 만들 수 있는 것

    ```
    결론적으로 자원을 효율적으로 이용하고, 배포 및 유지보수를 편리하게 하기 위해 WS와 WAS를 분리해서 사용하는 것
    ```

    
