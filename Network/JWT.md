# JWT 토큰 기반 인증

>회사에서 프로젝트를 진행하면서 로그인 관련 부분을 구현하게 되었다. 처음에는 단순히 Spring Security를 사용하면 되겠거니 했지만, 나름 프론트엔드와 백엔드 서버가 나뉨에 따라 로그인 관련 로직을 백엔드에서 처리해야 하는 상황이 되어 난감하던 중, 토큰 기반 인증에 대해 알게 되었다.
>
>기존에 늘 하던데로 Spring Security를 사용하게 되면 <form> 태그 기반 인증 및 인가를 구현해야 하기 때문에 프론트엔드 서버에 SecurityConfig 클래스를 만드는 등의 작업을 해야 하기 때문에 DB에 프론트 엔드 서버도 접근하게 되는 상황이 오게 된다. 하지만 토큰 기반 인증을 하게 될 경우에는 서버로부터 토큰을 발급받은 클라이언트들은 모두 로그인된 사용자로 간주하면 되기 때문에 이러한 문제를 해결할 수 있다.



[Session vs Token Based Authentication](https://sherryhsu.medium.com/session-vs-token-based-authentication-11a6c5ac45e4)

![img](https://blog.kakaocdn.net/dn/uFjeX/btqwuxGODK9/wzkbHxu0qL8vL7Gcriw8pK/img.png)



### 서버 기반 인증의 한계

```
http 프로토콜은 기본적으로 'stateless'한 특징을 가지고 있지만, 통신 과정에서 사용자의 상태 정보를 기억해야 하는 상황이 반드시 존재하기 때문에 세션 유지와 같은 상태 관리 기술이 필요한 것!
```

- __서버 기반 인증__ 은 기본적으로 서버에서 세션 관리를 통해 클라이언트의 상태 정보를 기억하는 방식임

  - 소규모의 SpringBoot 프로젝트라면 하나의 프로젝트 내에서 단순히 java단과 view단간에 서로 데이터만 주고받으면 되기 때문에 서버 기반 인증을 적용해도 큰 무리가 없음

  

- 하지만 __규모가 커져서 서버를 확장하게 되는 상황이라면__ 서버 기반 인증으로는 한계가 있음

  - 우선 세션 정보를 메모리에 저장하게 되는데, 대규모 트래픽이 발생하게 되면 서버의 RAM에 과부하가 걸리게 된다는 문제가 있음
  - 데이터베이스에 저장하는 방식을 생각해볼 수 있겠지만, 데이터베이스에의 접근 자체 또한 많은 부하를 요구하는 작업이라는 한계가 있음
  - 여러 대의 서버 컴퓨터를 유지하게 되면, 세션 또한 이에 맞게 분산 관리해야 하는 번거로움 또한 존재
  - __`CORS`__ 관련 문제에 있어서도 따라 종류가 다른 여러 도메인에서 쿠키를 관리하는 것이 번거로움
    - 세션 관리 또한 사실상 __`set-cookie`__ 헤더를 통해 동작하는, 쿠키에 기반한 것이기 때문에 CORS에서 자유로울 수 없는 것!

..

### 토큰 기반 인증

- 서버에서 정상적으로 인증받은 클라이언트에게 토큰을 발급하고, 이후 클라이언트는 서버에 요청할 때마다 발급받은 토큰을 헤더에 넣어 보냄으로써 유효성 검사를 거치게 되는 방식임

- 서버 기반 인증과 달리 클라이언트의 인증 관련 상태 정보를 세션에 저장하지 않고, 오로지 클라이언트로부터의 요청 헤더에 담긴 토큰 정보만을 가지고 작업을 처리

  - 따라서 상태 유지를 하지 않기 때문에 __Stateless__ 한 구조를 가지게 되며, 이것이 토큰 기반 인증이 주는 장점의 핵심이라 할 수 있음

  

- 발급된 토큰은 클라이언트쪽에 저장되기 때문에 서버는 인증/인가에 있어 완전히 Stateless한 구조를 가지기 때문에, 서버가 확장되었을 때, 어떠한 서버로 요청이 와도 크게 상관이 없어지게 됨을 의미

  - __`OAuth`__ 와 같이 특정 서비스의 인증 관련 기능을 다른 서비스에서도 사용하는 상황에서도 인증을 제공하는 서버에서 토큰에 선택적인 권한만 부여하여 발급하는 식의 기능을 구현할 수 있음

- 세션 관리를 하지 않는다는 점은 클라이언트가 서버에 요청을 보낼 때 사용자 정보 관련 쿠키를 전달하지 않음을 의미하며, 이를 통해 쿠키 탈취와 같은 보안 관련 취약점을 극복할 수 있음
  - 하지만 토큰을 따로 쿠키에 저장하는 등의 상황에서도 얼마든지 보안적인 문제가 발생할 수 있기 때문에, 보안성 측면은 항상 신경써야 함
- 다양한 디바이스 및 도메인 환경이 있다 하더라도, 동일한 토큰을 서버로 전달하기 때문에 환경의 제약 없이 클라이언트의 유효성을 검증할 수 있게 됨



..

### JWT(Json Web Token) 

![JSON Web Token Tutorial](https://blog.kakaocdn.net/dn/cxAQfR/btqVJQWEblL/DGGhEbvg7bdDwnS5uHbvI0/img.jpg)

- Json 형식으로 사용자의 속성 정보를 저장해놓은 토큰으로, 그 자체를 정보로 사용하는(__Self-Contained__) 방식으로 정보를 안전하게 전달함
- JWT 자체는 __`Header`__, __`Payload`__, __`Signature`__의 세부분으로 나뉘며 각 부분은 Base64로 인코딩되어 있으며, __'.'__ 로 각 부분이 구분됨
  - Base64 자체는 암호화가 아니기 때문에 인코딩된 문자열의 형태는 항상 같음
- __Header__
  - __`typ`__ 와 __`alg`__ 의 두 가지 정보로 구성되며, 각각 토큰의 타입(ex.JWT)과 __`Signature`__ 을 해싱하기 위한 알고리즘 방식을 의미함
- __Payload__
  - 토큰에 사옹되는 정보의 조각을 의미하는 __`Claim`__ 이 담겨있으며, __`Claim`__ 은 총 3가지로 나뉘며, JSON 형식으로 여러 정보를 담을 수 있음
  - __Registered Claim__
    - 토큰 정보를 표현하기 위해 __이미 정해진 종류의 데이터__ 를 의미

