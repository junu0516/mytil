## 쿠키와 세션



### 1) 쿠키

- 서버가 사용자의 웹브라우저로 전송하는 일종의 데이터 조각

- 사용자가 특정 웹사이트를 방문했을 경우, 해당 웹사이트를 제공하는 서버를 통해 사용자의 컴퓨터에 기록 파일이 저장되는데, 이를 쿠키라고 하는 것

- 쿠키가 필요한 이유는 우선 __http 통신의 무상태성__을 극복하기 위한 것

  - __`무상태성(Stateless)`__  : http 통신은 일단 요청과 응답 메시지를 전송하면, 이후의 연결에 대해서는 신경쓰지 않으므로(``비연결성``), 이전의 정보나 통신의 상태 등을 굳이 저장하지 않음
  - 이로 인해 자원의 낭비를 줄일 수 있고, 서버에의 과도한 부하를 줄일 수 있지만 동시에 클라이언트의 상태를 유지할 수 없다는 단점이 있음
  - 따라서 이를 위해 쿠키가 필요한 것

- 특정 웹사이트에 로그인 했을 경우 쿠키나 후술할 세션 관련 정보가 존재하지 않으면, 이후 연결시 로그인 상태를 유지할 수 없음

  - 다시 말해, 일일히 계속 로그인해야 하는 번거로움이 존재한다는 것

  ![img](https://blog.kakaocdn.net/dn/lek9m/btqRlIIvVeE/LukO8Sac8GQ5yEXkVK4tfk/img.png)

#### 쿠키의 특징 및 작동 방식

- 쿠키는 __이름, 값, 0개 이상의 속성__의 3가지 요소로 구성
- 쿠키 속성에는 만료 기간 및 경로정보 등의 정보가 담겨 있음
- 쿠키는 서버가 아닌 __클라이언트 단에 저장__됨
- 만료일을 굳이 지정하지 않으면, 웹브라우저 종료와 함께 삭제됨
- 웹브라우저에 서버의 쿠키 정보가 존재할 경우, __http 요청시 헤더에 쿠키를 담아 전송__

- 서버가 요청을 받으면 일단 WAS가 쿠키를 생성하여 웹브라우저(클라이언트)에게 보내며, 클라이언트는 서버로 부터 받은 쿠키를 자신의 디렉토리에 저장
- 이후 클라이언트가 동일 서버로 요청(Future Request)을 보낼 경우, 저장했던 쿠키도 같이 전송되며 서버에서 쿠키를 업데이트할 경우에는 응답과 함께 쿠키도 같이 전송됨
  - 쿠키를 동반한 요청이 들어올 경우 서버는 쿠키를 참고하여 비즈니스 로직을 수행



### 2) 세션

- 쿠키와 달리 서버에 저장되는 정보이며, 따라서 클라이언트의 상태정보와 같은 것들이 웹브라우저에 노출되지 않기 때문에 더욱 안전함
- 세션을 활용하게 되면 브라우저 종료 전까지는 클라이언트의 요청 상태가 유지되므로 주로 로그인 상태의 유지와 같은 경우에 활용됨
- 웹서버에 클라이언트에 대한 정보를 저장할 경우, 보통 클라이언트를 구분할 수 있게 고유 ID를 부여하는데 이를 __`세션 아이디(Session ID)`__라고 함
  - 클라이언트 정보를 세션에 두고, 부여된 세션 아이디로 인증하는 것



#### 세션의 특징 및 작동 방식

- 세션은 로컬 및 서버에 저장됨
- 세션은 쿠키를 통해 세션 ID 값만 저장하며, ID로 클라이언트를 구분해서 서버에서 처리
- 만료기간의 지정여부와 상관없이 세션은 브라우저의 종료와 함께 삭제됨
- 요청이 올때마다 서버에서 이를 처리해야 하는 과정을 수반하므로 쿠키의 사용에 비해 상대적으로 느림



![img](https://blog.kakaocdn.net/dn/boW0LG/btqRlI9MSfW/j5pkOEr5s85pzeWuLJhg9K/img.png)

- 웹브라우저가 서버에 요청을 보냄
- 서버는 요청받은 클라이언트에 대해, 쿠키로 부터 세션 아이디를 부여하고 클라이언트를 식별
  - 세션 아이디를 활용하여 HttpSession을 생성하는 것
- 이후 응답시, http 헤더의 쿠키에 세션 아이디를 포함해서 전송함(set-cookie)
- 웹브라우저는 이후의 요청(Future Request)에 대해, 부여받은 세션 아이디가 담긴 쿠키를 다시 http 헤더에 넣어 전송
- 이후의 요청을 받은 서버는 쿠키로부터 세션 아이디 및 세션 관련 정보를 확인 후 이에 맞는 로직을 처리하여 응답
  - 결국, 세션 역시 기본적으로 쿠키를 활용하여 정보를 주고받는 것이기 때문에 클라이언트의 상태 정보를 유지하기 위한 수단은 근본적으로 쿠키를 통해 이루어진다고 할 수 있음