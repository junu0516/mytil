## 운영체제 정리

### 프로세스와 스레드, 동기와 비동기의 차이

- __`프로세스`__ : 메모리에 올라가 실행중인 프로그램을 의미하며, 크게 텍스트와 데이터, 힙&스택 영역의 구조로 나뉨
  - 텍스트 영역에는 실행 가능한 코드가 저장됨
  - 데이터 영역에는 전역 데이터가 저장됨
  - 힙 영역에는 동적으로 런타임 시점에 생성된 객체 등이 저장됨
  - 스택 영역에는 함수 호출 시에 일시적으로 사용될 매개변수나 리턴 주소, 지역 변수 등이 저장됨
- __`스레드`__ : 프로세스 내에서 개별 실행 흐름의 작은 단위를 의미함
  - 보통 스레드의 생성 및 책임 관리를 개발자가 아닌 라이브러리 혹은 컴파일러에 넘기는데 이를 가리켜 __`암묵적 스레딩(Implicit Threading)`__ 이라고 부름
  - 멀티 코어 프로세싱이 갈수록 복잡해지면서 개발자가 스레드의 생명주기에 대한 책임을 지는 것이 부담스럽기 때문에 책임을 시스템으로 옮기는 것
  - 암묵적 스레딩 환경에서 __개발자의 책임은 스레드가 수행할 작업을 정의하는 데 있음__
- 텍스트 및 데이터 영역의 크기는 일반적으로 고정되있으며 스택과 힙 영역은 프로그램 실행 시점에 가변적인 크기를 가짐
  - 함수 호출 시에 지역변수와 매개변수, 리턴주소 등을 포함한 __`activation record`__ 가 스택에 추가됨
  - 객체가 생성되면 힙에 적재되며, 쓰임이 다한 객체는 메모리에서 해제되고 힙의 크기도 줄어듦
- 프로세스의 상태는 **`생성(New)`** , **`실행(Running)`** , **`대기(Waiting)`** , **`준비(Ready)`** , **`종료(Terminated)`** 의 5가지로 나뉨
  - 생성: 프로세스가 말 그대로 새롭게 생성된 상태를 의미
  - 실행 : 명령(Instructions)들이 실행되는 상태를 의미
  - 대기 : 프로세스가 입출력과 같은 특정 이벤트를 위해 대기하는 상태를 의미
  - 준비 : 프로세스가 실행을 위해 프로세서에 할당되는 것을 기다리는 상태를 의미
  - 종료 : 프로세스가 모든 실행을 종료한 상태를 의미
- 프로세스가 동기적으로 실행된다는 것은 절차에 따라 명령을 수행한다는 것을 의미함
  - __두 개이상의 프로세스의 작업 순서를 결정하는 것__ 을 가리켜 __`프로세스의 동기화`__ 라고 부르는 것
- 비동기적인 실행은 코드를 순차적으로 실행하지 않을 수도 있는 상황을 의미함
- __`동시성`__ : 여러 작업이 모두 처리될 수 있도록, 해당 작업에 대한 지원을 모두 수행하는 것을 의미
- __`병렬성`__ :  동시에 하나 이상의 작업 수행이 가능하다는 것을 의미
- 동시성에서 __작업을 모두 처리할 수 있다는__ 것은 일정 단위의 시간 내에서 __`문맥 교환`__ 을 통해 여러 작업을 순차적으로 처리한다는 것을 의미함
- 엄밀히 말해서 __물리적으로 동시에 여러 작업이 처리되는 것은__ 병렬성에 해당됨
- __`문맥교환(Context Switching)`__ : 하나의 프로세스가 CPU를 사용하는 상황에서 다른 프로세스가 CPU를 사용 가능하도록 이전 프로세스의 상태(문맥)를 잠시 보관하고, 새로운 프로세스의 상태(문맥)를 적재하는 작업을 의미함
  - 여기서 프로세스의 문맥은 프로세스마다 가지고 있는 __`프로세스 제어블록(PCB)`__ 에 기록됨

### 멀티스레딩에 환경에서의 자원획득

- 여러 개의 스레드를 비동기적으로 실행시킬 수 있는 컴퓨터 환경을 __`멀티 스레딩 환경`__ 이라고 부름
- 운영체제에서 보통 스레드에 대한 지원은 __`사용자 수준`__ 과 __`커널 수준`__ 으로 나눠볼 수 있으며, 여기서 사용자 수준 스레드와 커널 스레드 간의 관계는 크게 3가지로 나뉨
  - __`Many-to-One Model`__ : 여러 사용자 스레드가 하나의 커널 스레드와 관계를 맺는 구조로 커널 스레드에 한 번에 하나의 사용자 스레드만 접근 가능하므로 병렬 처리가 불가능하다는 단점이 있음
  - __`Many-to-Many Model`__ : 여러 사용자 스레드가 여러 커널 스레드와 관계를 맺는 구조로 동시성을 보장하면서 더 적은 양의 커널 스레드를 요한다는 이점이 있음
  - __`One-to-One Model`__ : 여러 사용자 스레드가 각각 하나의 커널 스레드에 일일히 대응되는 구주로, 하나의 스레드가 작업을 차단헤드 다른 스레드가 계속 작업을 수행할 수 있으므로 동시성을 보장하기 수월

- 운영체제가 여러 프로세스에 자원을 배분하는 과정을 __`스케줄링(Scheduling)`__ 이라고 부름
  - __`선점형`__ : 진행 중인 작업에 인터럽트를 걸고 다른 작업에 CPU를 할당하는 전략
  - __`비선점형`__ : 프로세스가 CPU를 할당받아 실행이 시작되면, 프로세스 자체가 I/O 인터럽트를 걸거나 프로세스를 종료할 때까지 실행상태에 있게 하는 전략
  - 높은 우선순위의 프로세스가 우선 동작해야 한다면 선점형이 유용하겠지만 그만큼 문맥교환으로 인한 오버헤드가 많다는 단점이 존재 (대표적으로 __`Round-Robin Scheduling`__ 이 여기에 속함)
  - 비선점형은 모든 프로세스를 순차적으로 공쟁하게 실행시킬 수 있지만, 동시에 짧은 작업이 긴 작업을 오랫동안 기다려야 하는 비효율을 초래할 수 있음(대표적으로 __`First-Come-First-Served Scheduling`__ 이 여기에 속함)

- 여러 스레드가 동시적으로 실행될 때, __스레드가 동시에 접근 가능한 자원__ 을 가리켜 __`공유자원`__ 이라고 부름
- 보통 프로세스가 여러 개의 스레드로 분기되면, 각 스레드는 __코드와 데이터 영역을 공유하고 고유의 스택 영역을 가지게 됨__
  - 하나의 프로세스가 둘 이상의 실행 흐름을 갖기 위해서 멀티 스레딩을 하는 것인데, 각 스레드마다 메모리 구조가 분리되면 문맥 교환 시에 발생하는 오버헤드의 양이 그만큼 늘어남
  - 따라서 데이터 영역과 힙 영역은 공유함으로써, 이들을 분리시켜 올려야 하는 번거로움을 제거한 것
  - 여기서 데이터 영역과 힙 영역은 공유되는 영역이므로 이들을 활용하여 스레드 간 데이터의 교환도 가능
- __`교착상태`__ : 두 개 이상의 프로세스가 자원을 점유하고 있는 상황에서 서로 다른 프로세스가 점유중인 자원을 요구하면서 뭏나정 기다리는 상황
- 교착상태가 발생하기 위한 필요조건은 일반적으로 4가지가 있으며, 아래 4가지에서 하나라도 충족되지 않으면 교착상태가 발생하지 않음
  - 상호배제 : 하나의 프로세스가 임계영역에 들어가면 다른 프로세스는 접근 불가능
  - 점유대기 : 어떤 프로세스가 자원을 할당받아 배타적으로 점유할 때, 다른 프로세스가 이 자원을 사용하고 싶으면 자원이 할당 해제될 때까지 기다려야 함
  - 비선점 : 특정 프로세스에 할당된 자원을 해당 프로세스가 자원을 반납하기 전까지는 할당 해제되지 않음
  - 환형대기 : 프로세스의 자원점유 및 점유 자원에 대한 요구 관계는 환형을 이룸

### Critical Section(임계영역)

- __`임계영역`__ 은 일종의 공유변수 영역인 데, __두 개 이상의 스레드가 동시에 접근할 수 없는 공유자원에 접근하는 코드의 일부를 의미함__
- 여기서 2개이상의 프로세스가 임계영역에 진행하지 못하도록 막는 것을 __`상호배제`__ 라고 부르는 것
- 임계영역에의 동시접근 문제 해결을 위해서는 일반적으로 아래 3가지 조건을 충족해야 한다고 알려져 있음
- __상호배제__ : 하나의 프로세스가 임계영역에 들어가있으면 다른 프로세스는 접근 불가능
  - __진행__ : 임계영역에서 실행중인 프로세스가 없고, 여러 프로세스가 임계영역에 진입하고자 하면 그 중에서 적절히 하나를 결정해야 하며 이러한 결정을 무한정 미룰 수 없음
  - __제한된 대기__ : 한 프로세스가 임계영역 진입 요청을 한 후 수락될 때까지 다른 프로세스가 임계영역 진입을 허가받는 횟수에 제한이 있어야 함
- __`Lock`__ : 하나의 스레드 혹은 프로세스가 자원을 사용중일 때는, 락을 걸어서 다른 것이 접근 못하게 하는 것
  - 보통 bool 타입 변수의 true/false 여부로 락이 걸려있는 지 여부를 판단
  - 만일 특정 프로세스나 스레드가 락을 제대로 통제하지 못해서, 다른 것이 임계영역에 접근하는 문제를 고려해야 함
- __`Semaphore`__ : 공용변수를 정의해서, 사용 가능한 자원의 수나 잠김 및 열림 등의 상태를 나타내는 값을 저장하고, 해당 공용변수에 접근할 수 있는 표준단위 연산을 정해놓는 것
  - 보통 P(s), V(s)의 두 가지 연산을 정의하며, 각각 임계구역에 접근하기 전과 나오는 시점에 수행됨
  - 한 프로세스 혹은 스레드에서 세마포어를 변경하면, 다른 프로세스나 스레드가 이 값을 변경할 수 없음
  - 세마포어의 값이 0이면 자원에 접근할 수 없도록 하고, 0보다 크면 임계구역에의 접근을 허용함과 동시에 감소연산을 실행
  - 이후 임계영역을 나가는 시점에 다시 증가연산을 실행하여 다른 프로세스가 임계영역에 접근할 수 있도록 하는 것

------

1. 프로세스와 스레드의 차이는 무엇일까
   - 프로세스는 시스템에서 실행중인 프로그램을 의미
   - 스레드는 프로세스 내부에서 실행 흐름의 단위를 의미함
2. 프로세스의 메모리 구조는 어떻게 될까
   - 4개의 영역으로 나뉨
   - 스택,힙,데이터,텍스트 영역으로 나뉨
3. 동시성과 병렬성은 각각 어떤 의미일까 
4. 프로세스를 어떻게 동시적으로 처리할까
   - PCB와 Context Switching -> 프로세스가 어떻게 상태정보를 저장하는 지
   - Context Switching의 단점 -> 이것이 완벽한 오버헤드로 간주된다는 내용
5. 멀티 스레딩의 의미는 무엇일까
6. 멀티 스레딩 환경에서 프로세스 내의 여러 스레드는 어떤 형식의 메모리 구조를 가질까
   - 왜 프로세스가 굳이 스택만 공유하는 지?
7. 3가지 멀티 스레딩 모델에 대해 이야기, 각각의 단점이 있다면
   - 일대일 : 오늘날 많이 쓰임
   - 다대다 : 위보다 효율적이지만, 오늘날 컴퓨터 기술이 좋아져서 그냥 위에거 씀
   - 다대일 : 한 번에 커널 스레드에 한 번만 접근하기 땜누에 비효율적
8. 운영체제가 프로세스를 스케줄링의 성능을 위해 어떤 요소를 고려해볼 수 있을까?
   - 공정성과 균형 : 각각 모든 프로세스의 자원 할당 받는 지 여부와, 여러 시스템 자원이 충분히 활용되는 지 여부
   - 알고리즘 성능을 평가할 때는 평균 대기시간과 평균 반환시간의 두 가지 척도로 판단
9. 선점형 스케줄링과 비선점형 스케줄링의 차이점과, 각각의 대표적인 알고리즘 예시를 하나씩 이야기해보자
10. 교착상태가 일어나기 위한 필요조건은?
    - 상호배제 : 한 번에 하나의 프로세스만 공유자원 점유
    - 점유대기 : 쓰고 싶으면 남이 다 쓸 때까지 기다려라
    - 비선점 : 자원은 타의에 의해 제거 불가능
    - 환형대기 : 요구, 할당의 간선이 환형을 이룸
11. 교착상태를 해결하기 위한 조건 하나만 이야기해보자
12. 임계영역이란 무엇일까
13. 여러 스레드가 임계영역에 동시에 접근하지 못하도록 어떤 점을 고려해야 할까
14. 세마포어란 무엇인가

------

### 추가로 생각해볼 것들 

![image-20220412215650837](/Users/junu/Library/Application Support/typora-user-images/image-20220412215650837.png)

- 위의 작업이 교착상태를 어떻게 유발할 수 있을까? (customQueue.sync로 수정)
- 메인 싱크가 왜 안될까? 와 직결되는 문제

- GCD에서 메인큐, 글로벌큐, 커스텀큐의 동기/비동기 작업 수행의 차이

- 컨텍스트 스위칭은 멀티 스레딩이 더 가볍다.

- 싱글 스레드 환경에서도 동시성 충족이 가능하다 대표적인 것이 이벤트루프

  