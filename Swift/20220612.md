# 가상메모리

### 가상메모리(Virtual Memory)?

![img](https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Virtual_memory.svg/220px-Virtual_memory.svg.png)

- 컴퓨터 시스템의 메모리 크기보다 더 큰 크기를 가지는 프로세스를 실행하기 위해 사용하는 방법
- 실제로 이용 가능한 메모리를 논리적으로 추상화하여, 사용자에게는 마치 실제 메모리처럼 보이게 하는 것
- 프로그램에는 메모리의 __`실주소(Physical Address)`__ 가 아닌, __`가상주소(Virtual Address)`__ 가 부여됨
- 실행중인 프로세스가 참조하는 가상주소의 범위는 프로세스의 __`가상주소 공간(Virtual Address Space)`__ 라고 부르고, 사용 가능한 실주소의 범위는 __`실주소 공간(Real Address Space)`__ 이라고 부름
- 언급한대로 프로세스는 오직 가상주소만을 참조하는 형식이지만, 메모리상에서 프로세스가 실행되기 위해서는 가상주소는 반드시 실주소로 변환되야 하며, 이를 __`사상(Mapping)`__ 이라고 부름
- 사상이 빨리 수행되지 않으면 가상주소가 실주소로 빨리 변환되지 못해 프로세스의 실행이 제대로 되지 않을 수 있기 때문에 가상주소와 실주소 간의 연관이 효율적으로 이루어져야 함

​    

### 블록 단위 주소 변환

- __`동적 주소 변환(Dynamic Address Translation)`__ 은 프로세스의 런타임 시점에 가상주소가 실주소로 바뀌는 절차가 실행되는 것을 의미함
- 만일 가상 메모리상의 위치가 실제 메모리의 어느 곳에 위치하는 지를 알고 싶으면 보통 __`주소 변환 사상표(Address Translation Mapping Table)`__ 을 유지해야 하며, 보통 이러한 사상표는 효율적인 정보 관리를 위해 정보를 __`블록(Block)`__ 이라는 단위로 분류함
- 즉, 정보를 블록 단위로 분류하고 각 블록이 메인 메모리의 어느 위치를 나타내는 지를 사상표로 관리하는 것
- 블록의 크기가 동일할 경우에는 __`페이지(Page)`__ 라는 개념을 사용하며, 페이지 단위의 가상메모리 구성을 __`페이징(Paging)`__ 기법이라고 부름
- 블록의 크기가 다를 경우에는 __`세그먼트(Segment)`__ 라는 개념을 사용하며, 세그먼트 단위의 가상메모리 구성을 __`세그먼테이션(Segmentation)`__ 이라고 부름

​    

### 페이징 기법

- 가상메모리를 고정된 크기의 블록인 페이지(Page) 단위로 나누어 관리하며 보통 v = (p,d) 와 같은 식으로 나타냄

  - 여기서 p는 페이지 번호를, d는 p로부터의 페이지 변위를 의미함

- 프로세스가 실행되기 위해 특정 페이지를 참조하고자 한다면, 해당 페이지는 메모리에 반드시 위치해야 함

- 이를 위해 실 메모리 영역 또한 가상 메모리와 동일하게 고정된 크기의 블록으로 나뉘어야 하는데, 여기서 동일하게 나뉜 각 블록을 페이지 __`프레임(Page Frame)`__ 이라고 부름

  - 다시 말해, 가상 메모리의 페이지 개념을 반영할 수 있도록 실 메모리에도 동일한 틀을 만들어 둔 것
  - 이후 페이지는 비어있는(가용 상태의) 페이지 프레임 아무 곳에나 적재하면 됨

- 이후 __`페이지 사상표(Mapping Table)`__ 라는 것을 사용해서 프로세스가 사용하는 가상주소를 메모리에 적재된 후에도 바로 찾을 수 있도록 실주소로 동적 변환함

- 사상표에는 페이지 번호에 대한 실주소의 페이지 프레임 번호가 저장되있으며, 해당 페이지가 메모리에 존재하는 지 여부를 나타내는 비트값도 가지고 있음

- 이런 식으로 페이지 사상표를 직접 이용해서 동적 주소 변환을 하는 것을 __`직접 사상`__ 이라고 함

- 페이지 변환 정보를 연관기억장치에 저장한 연관 사상표를 이용하여 동적 변환을 할 경우에는 __`연관 사상`__ 이라고 함

  - 연관기억장치는 저장된 값을 이용해서 데이터에 액세스하는 고속 메모리 장치를 말함

- 보통은 연관사상과 직접 사상을 같이 사용하며, 연관 사상표에는 가장 최근에 참조된 페이지 항목을 보관하고 나머지는 페이지 사상표에 수록해서 연관 사상표에 없는 경우에는 직접 사상을 적용하는 식으로 구현

- 한편, 메모리가 동일 크기의 페이지 프레임으로 나뉘며, 메모리 보호도 페이지 단위로 이루어지기 때문에 페이징 기법에서 __`외부 단편화`__ 는 발생하지 않음

- 하지만 개별 페이지에 대해 작은 크기의 공간들이 여전히 생길 수 있기 때문에 __`내부 단편화`__ 문제는 계속 존재함

  

### 세그먼테이션 기법

​    